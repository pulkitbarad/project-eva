const COMMUNICATION_TYPE_ERROR=-1;const COMMUNICATION_TYPE_CHOICE=2;const COMMUNICATION_TYPE_LITERAL=3;const COMMUNICATION_TYPE_FIELD_SUGG=5;const COMMUNICATION_TYPE_UNARY_SUGG=7;const COMMUNICATION_TYPE_QUESTION_SUGG=11;const COMMUNICATION_TYPE_RELATIONSHIPS=13;const COMMUNICATION_TYPE_DEFAULT=17;const COMMUNICATION_TYPE_UPD_FIELD=19;const COMMUNICATION_TYPE_UPD_LITERAL=23;const COMMUNICATION_TYPE_UPD_QUESTION=29;const COMMUNICATION_TYPE_UPD_CRIT_FIELD=31;const COMMUNICATION_TYPE_UPD_SELECT_FIELD=37;const COMMUNICATION_TYPE_EXECUTION_STARTED=41;const COMMUNICATION_TYPE_GET_RESULT=43;const COMMUNICATION_TYPE_RESULT_AVAILABLE=47;const COMMUNICATION_TYPE_EXECUTION_RUNNING=53;const COMMUNICATION_TYPE_EXECUTION_FAILED=59;const COMMUNICATION_TYPE_MAPPING=61;const COMMUNICATION_TYPE_LOAD_INTO_TABLE=67;const LiteralSuggestionMessage="Take the input literally.";const FieldSuggestionMessage="I have a suggestion for it.";const UnarySuggestionMessage="I have a suggestion for the expression.";const QuestionSuggestionMessage="I have a question that will explain it.";const SaveResultSuggestionMessage="Save the results with a name.";const GetResultSuggestionMessage="Get me the results.";const systemFileLabel="System File";var activeCustomerFiles=[];var activeEvaTables=[];var activeProgressMonitors=[];var loadingMessage={lineNumber:0,messageTimeMillis:Date.now(),userName:"Eva",text:"Please wait while I load messages",isChart:false,metadata:[],data:[],topics:[]};var emptyMessage={lineNumber:0,messageTimeMillis:Date.now(),userName:"Eva",text:"No history available for selected topics. Please scroll down to load older messages or change the topic.",isChart:false,metadata:[],data:[],topics:[]};var historyMessages=[loadingMessage];var currHistoryStartLineNumber=0;var currHistoryEndLineNumber=0;var currRelMesssageFieldCount=0;var nuoEvaMessageHolder={};var nuoUserMessageHolder={};var nuoConversationResponse=null;var isHistoryLoading=false;var isHistorySaving=false;var lastSaveMarker=2;function initUI(){loadChartLib(loadRestOfUI);$("html, body").animate({scrollTop:0},"fast")}function loadChartLib(a){google.charts.load("current",{packages:["corechart","gantt","sankey","calendar","line","bar","map","scatter"]});google.charts.setOnLoadCallback(a)}function loadRestOfUI(){$("#moveToTopButton").on("click",function(){$("html, body").animate({scrollTop:0},"slow")});$("#customerFilesTable").hide();$("#customerFilePath").hide();$("#evaFilesButton").on("click",evaFilesButtonHandler);$("#fileInput").on("change",uploadFileSeletionHandler);$("#customerFileDeleteButton").on("click",deleteFileSelectionHandler);$("#customerFileNewFolderButton").on("click",newFolderButtonHandler);$("#customerFileLoadTableButton").on("click",loadIntoTableFileSelectionHandler);$("#customerFileAnalyzeImageButton").on("click",analyzeImageFileSelectionHandler);addCustomerTableEventHandlers();$("#evaTablesButton").on("click",evaTablesButtonHandler);$("#storageExplorerDeleteButton").on("click",deleteTableSelectionHandler);addStorageExplorerEventHandlers();$("#evaProgressButton").on("click",evaProgressButtonHandler);addProgressMonitorEventHandlers();addTopicButtonHandlers();$("#activeUsername").text("Welcome "+activeUsername+"!");if(!profileImageUrl||profileImageUrl.trim().length==0){profileImageUrl="./public/assets/images/unknown_user.png"}var a="<label for='fileInputImage' class='fileInputImage'>";a+="<img id='profileImageFile' width='128px' height='128px' src='"+profileImageUrl+"'/>";a+="</label>";$("#profileImage").append(a);$("#fileInputImage").on("change",profileImageSelectionHandler);$("#profileUserName").text(activeUsername);loadMessageContainer();renderHistorySection();initUserChoiceWindow();initUserSuggestionWindow();initEntityRelationshipWindow();initMapperWindow();initFileLoadOptionsWindow();initAnalyzeImagesOptionsWindow();readFromHistory();addHistoryScrollEvent();createPlatformMetrics()}function addTopicButtonHandlers(){$("#topicComboBox").jqxComboBox({source:historyTopics,width:"100%",height:"2.5em",multiSelect:true,theme:jqWidgetThemeName});$("#topicComboBox").jqxComboBox({autoDropDownHeight:true});$("#topicComboBox").on("change",function(e){var b=e.args;if(b){var d=b.item;var a=d.label;var f=d.value;var c=b.type;renderHistorySection()}});$("#newTopicButton").on("click",function(){var a=prompt("What is the name of topic?","New topic");if(a!=null&&a.trim().length>0){historyTopics.push(a)}$("#topicComboBox").jqxComboBox("addItem",a);$("#topicComboBox").jqxComboBox("selectItem",a)});$("#removeTopicButton").on("click",function(){var a=getSelectedTopics();a=a.filter(function(b){if(b!=="Default"){$("#topicComboBox").jqxComboBox("unselectItem",b);$("#topicComboBox").jqxComboBox("removeItem",b);return true}else{return false}});historyTopics=historyTopics.filter(function(b){return a.indexOf(b)<0})})}function getSelectedTopics(){var a=$("#topicComboBox").jqxComboBox("getSelectedItems").map(function(b){return b.label});return a}function addHistoryScrollEvent(){$(window).scroll(function(){if(!isHistoryLoading&&$(window).scrollTop()+$(window).height()>$(document).height()-10){if(currHistoryStartLineNumber>1){readFromHistory()}}})}function loadSplitters(a,b){$("#mainContainer").jqxSplitter({width:$(window).width()-20,height:$(window).height()-20,panels:[{size:"10%",collapsible:true},{size:"90%",collapsible:false}],theme:jqWidgetThemeName})}function loadMessageContainer(){$("#sendMessage").on("click",sendMessageHandler);$("#messageBox").keydown(function(a){if(a.ctrlKey&&a.keyCode==13){sendMessageHandler()}})}function initAnalyzeImagesOptionsWindow(){var a=$(".historyBody").offset();$("#analyzeImageOptionsWindow").jqxWindow({width:700,height:400,title:"How do you want to analyze the selected images?",resizable:true,autoOpen:false,position:{x:a.left+200,y:a.top+50},initContent:function(){},theme:jqWidgetThemeName});$("#analyzeImageOptionsConfirmButton").on("click",analyzeImageOptionsConfirmHandler)}function analyzeImageFileSelectionHandler(){$("#analyzeImageOptionsWindow").jqxWindow("open")}function analyzeImageOptionsConfirmHandler(){var d=$("#customerFilesTable").jqxGrid("getselectedrowindexes");if(d&&d.length>0){var a=[];d.map(function(f){return $("#customerFilesTable").jqxGrid("getrowdata",f)}).forEach(function(g){var f=g.fileName;if(g.isDirectory){a=a.concat(activeCustomerFiles.filter(function(i){var j=encodeURI(g.fileLabel)+"/";var h=getParentFilePath();if(h&&h.length>0&&h!=="/"){j=h+j}return i.fileName.startsWith(j)&&!i.fileName.endsWith(systemFileLabel)}).map(function(h){return h.fileName}))}else{if(!f.endsWith(systemFileLabel)){a.push(f)}}});$("#customerFilesTable").jqxGrid("clearselection");var c={};c.TargetTableName=$("#targetTableNameImage").val();c.SourceFiles=a;c.LanguageHints=$("#languageHint").val();c.ShouldAppend=$("#shouldAppendImage").is(":checked");var b=d.map(function(f){var g=$("#customerFilesTable").jqxGrid("getrowdata",f);if(g.isDirectory){return g.fileLabel+"/*"}else{return g.fileLabel}});var e=new Date()+"";e=e.substring(0,e.indexOf("("));nuoUserMessageHolder.Message="Analyze Images "+b.map(function(f){return"<b>"+f+"</b>"}).join(" AND ")+" and lod results into table <b>"+c.TargetTableName+"</b>. <br><br>Note: This task has been created by Eva on your behalf on "+e;nuoUserMessageHolder.NuoAnalyzeImageOptions=c;nuoUserMessageHolder.CommunicationType=COMMUNICATION_TYPE_LOAD_INTO_TABLE;sendMessageToEva(true,true,true)}$("#fileLoadOptionsWindow").jqxWindow("close")}function initFileLoadOptionsWindow(){var a=$(".historyBody").offset();$("#fileLoadOptionsWindow").jqxWindow({width:700,height:400,title:"How do you want to load the selected files?",resizable:true,autoOpen:false,position:{x:a.left+200,y:a.top+50},initContent:function(){},theme:jqWidgetThemeName});$("#fileLoadOptionsConfirmButton").on("click",fileLoadOptionsConfirmHandler)}function loadIntoTableFileSelectionHandler(){$("#fileLoadOptionsWindow").jqxWindow("open")}function fileLoadOptionsConfirmHandler(){var c=$("#customerFilesTable").jqxGrid("getselectedrowindexes");if(c&&c.length>0){var a=[];c.map(function(f){return $("#customerFilesTable").jqxGrid("getrowdata",f)}).forEach(function(g){var f=g.fileName;if(g.isDirectory){a=a.concat(activeCustomerFiles.filter(function(i){var j=encodeURI(g.fileLabel)+"/";var h=getParentFilePath();if(h&&h.length>0&&h!=="/"){j=h+j}return i.fileName.startsWith(j)&&!i.fileName.endsWith(systemFileLabel)}).map(function(h){return h.fileName}))}else{if(!f.endsWith(systemFileLabel)){a.push(f)}}});$("#customerFilesTable").jqxGrid("clearselection");var e={};e.TargetTableName=$("#targetTableName").val();e.SourceFiles=a;e.FileFormat=$("#fileFormat").val();e.Delimiter=$("#delimiter").val();e.QuoteCharacter=$("#quoteCharacter").val();e.ShouldAppend=$("#shouldAppend").is(":checked");e.RowsToSkip=parseInt($("#rowsToSkip").val());if(!e.RowsToSkip){e.RowsToSkip=0}var b=c.map(function(f){var g=$("#customerFilesTable").jqxGrid("getrowdata",f);if(g.isDirectory){return g.fileLabel+"/*"}else{return g.fileLabel}});var d=new Date()+"";d=d.substring(0,d.indexOf("("));nuoUserMessageHolder.Message="Load files "+b.map(function(f){return"<b>"+f+"</b>"}).join(" AND ")+" into table <b>"+e.TargetTableName+"</b>. <br><br>Note: This task has been created by Eva on your behalf on "+d;nuoUserMessageHolder.NuoFileLoadOptions=e;nuoUserMessageHolder.CommunicationType=COMMUNICATION_TYPE_LOAD_INTO_TABLE;sendMessageToEva(true,true,true)}$("#fileLoadOptionsWindow").jqxWindow("close")}function initUserChoiceWindow(){var a=$(".historyBody").offset();$("#userChoiceWindow").jqxWindow({width:700,height:400,title:"Please make the appropriate choice",resizable:true,autoOpen:false,position:{x:a.left+200,y:a.top+50},initContent:function(){},theme:jqWidgetThemeName});$("#userChoiceListBox").jqxListBox({source:[],multiple:false,width:400,height:300,theme:jqWidgetThemeName});$("#userChoiceListBox").on("dblclick",userChoiceConfirmationHandler)}function initUserSuggestionWindow(){var a=$(".historyBody").offset();$("#userSuggestionWindow").jqxWindow({width:700,height:400,resizable:true,autoOpen:false,title:"Please make a suggestion",okButton:$("#userSuggConfirmButton"),position:{x:a.left+200,y:a.top+50},initContent:function(){},theme:jqWidgetThemeName});$("#userSuggestionTextBox1").jqxTextArea({placeHolder:"Type your suggestion here...",height:100,width:500,minLength:1,source:[],theme:jqWidgetThemeName});$("#userSuggestionTextBox2").jqxTextArea({placeHolder:"Type your suggestion here...",height:100,width:500,minLength:1,source:[],theme:jqWidgetThemeName});$("#userSuggConfirmButton").jqxButton({width:"80px",disabled:false,theme:jqWidgetThemeName});$("#userSuggConfirmButton").on("click",userSuggConfirmationHandler)}function userChoiceConfirmationHandler(){updUserSuggWindowElements();$("#userChoiceWindow").jqxWindow("close")}function initEntityRelationshipWindow(){var a=$(".historyBody").offset();$("#entityRelationshipWindow").jqxWindow({width:700,height:400,resizable:true,autoOpen:false,position:{x:a.left+150,y:a.top+25},initContent:function(){},theme:jqWidgetThemeName});$("#entityRelationshipWindow").jqxWindow("setTitle","Explain relationship between tables");loadStorageEntitiesTree()}function initMapperWindow(){var c=$(".historyBody").offset();$("#mapperWindow").jqxWindow({width:"60em",height:"30em",autoOpen:false,showCloseButton:true,position:{x:c.left+150,y:c.top+25},initContent:function(){},theme:jqWidgetThemeName});var a=["LeftItem1","LeftItem2","LeftItem3","LeftItem4"];var b=["RightItem1","RightItem2","RightItem3","RightItem4"];$("#mapperWindow").jqxWindow("setTitle","Explain the mapping between source and target columns.");$("#mapperWindow").jqxWindow({showCloseButton:true});$("#confirmMapperButton").on("click",function(){nuoUserMessageHolder.Responses=getMapperConnections();nuoUserMessageHolder.Message=nuoUserMessageHolder.Responses.map(function(d){return d.replace("|~|","->")}).join(" <i>AND</i> ");$("#mapperWindow").jqxWindow("close");sendMessageToEva(false,false,true)})}function loadConnections(){jsPlumb.ready(function(){jsPlumbRef=jsPlumb.getInstance();jsPlumbRef.importDefaults({Connector:["Bezier",{margin:20,curviness:150}],Anchors:["TopCenter","BottomCenter"],ConnectionsDetachable:true});jsPlumbRef.setContainer("mapperBodyContainer");$("#mapperLeftPane").scroll(function(){jsPlumbRef.repaintEverything()});$("#mapperRightPane").scroll(function(){jsPlumbRef.repaintEverything()});var k={endpoint:"Dot",paintStyle:{radius:8,fill:"var(--nuo-orange-solid)",opacity:0.5},isSource:true,connectorStyle:{stroke:"#666"},maxConnections:-1};var h={endpoint:k.endpoint,paintStyle:{radius:k.paintStyle.radius,fill:"var(--nuo-blue-solid)",opacity:k.paintStyle.opacity},connectorStyle:k.connectorStyle,isTarget:true,maxConnections:-1};var a=1;var g=nuoEvaMessageHolder.NuoMappingInput.NuoSourceList;var m=nuoEvaMessageHolder.NuoMappingInput.NuoTargetList;for(var d=0;d<g.length;d++){var j=g[d].label;var e="leftItem"+d;var f="<div id='"+e+"' class='mapperItem'>"+j+"</div>";$("#mapperLeftPane").append(f);var c=jsPlumbRef.makeSource(e,{anchor:"Right"},k)}for(var d=0;d<m.length;d++){var j=m[d].label;var e="rightItem"+d;var n="<div id='"+e+"' class='mapperItem'>"+j+"</div>";$("#mapperRightPane").append(n);$("#"+e).dblclick(function(r){var o=r.target.id;var p=jsPlumbRef.getConnections({target:o});for(var q=0;q<p.length;q++){jsPlumbRef.deleteConnection(p[q])}jsPlumbRef.removeAllEndpoints(o)});var l=jsPlumbRef.makeTarget(e,{anchor:"Left"},h);var b=jsPlumbRef.connect({source:"leftItem"+m[d].inputIndex,target:"rightItem"+d})}jsPlumbRef.bind("beforeDrop",function(r){var p=r.targetId;var o=jsPlumbRef.getConnections({target:r.targetId});for(var q=0;q<o.length;q++){jsPlumbRef.deleteConnection(o[q])}return true})})}function getMapperConnections(){var a=jsPlumbRef.getConnections().map(function(b){return b.source.outerText+"|~|"+b.target.outerText});return a}function loadStorageEntitiesTree(){$("#storageEntitiesTree").jqxTree({width:"95%",height:"95%",toggleMode:"click",theme:jqWidgetThemeName});$("#entityRelationshipListBox").jqxListBox({multiple:false,width:"95%",height:"95%",theme:jqWidgetThemeName});$(document).on("dblclick","#storageEntitiesTree  .jqx-tree-item",function(e){var b=e.target;if(b.tagName!="LI"){b=$(b).parents("li:first")}var d=$("#storageEntitiesTree").jqxTree("getItem",b[0]);var f=d.value;if(f){var c=$("#messageBox").val();var a="";if(nuoUserMessageHolder.CommunicationType!=COMMUNICATION_TYPE_RELATIONSHIPS){if(c.length==0){}else{a=", "}$("#messageBox").val(c+a+f.FieldName+" from "+f.EntityName)}else{if(currRelMesssageFieldCount%2==0){nuoUserMessageHolder.NuoCommonFields.push({leftField:f,rightFields:[]})}else{nuoUserMessageHolder.NuoCommonFields[nuoUserMessageHolder.NuoCommonFields.length-1].rightFields.push(f)}currRelMesssageFieldCount+=1;refreshEntityRelationshipListBox();$("#storageEntitiesTree").jqxTree("collapseAll")}}});$("#confirmRelationshipButton").on("click",function(){currRelMesssageFieldCount=0;nuoUserMessageHolder.Message=$("#entityRelationshipListBox").jqxListBox("getItems").map(function(a){return a.html}).join(" <i>AND</i> ");$("#entityRelationshipWindow").jqxWindow("close");sendMessageToEva(false,false,true)});$("#redoRelationshipButton").on("click",function(){currRelMesssageFieldCount=0;nuoUserMessageHolder.NuoCommonFields=[];refreshEntityRelationshipListBox()})}function refreshEntityRelationshipWindow(){refreshStorageEntitiesTree();refreshEntityRelationshipListBox();$("#entityRelationshipMsg").html(nuoEvaMessageHolder.Message);$("#entityRelationshipWindow").jqxWindow("open")}function refreshMapperWindow(){$("#mapperMsg").html(nuoEvaMessageHolder.Message);$("#mapperWindow").jqxWindow("open");$("#mapperWindow").jqxWindow("focus");loadConnections()}function refreshStorageEntitiesTree(){$("#storageEntitiesTree").jqxTree({source:nuoEvaMessageHolder.NuoEntities.map(function(a){return{label:a.EntityName,expanded:false,items:a.Fields.map(function(b){return{label:b.FieldName,value:b}})}}).sort(function(a,b){if(a.label<b.label){return -1}if(a.label>b.label){return 1}return 0})});$("#entityRelationshipListBox").jqxListBox({source:[]})}function refreshEntityRelationshipListBox(){var a=nuoUserMessageHolder.NuoCommonFields.map(function(d){var e=d.leftField;var c="<b>"+e.FieldName+"</b> of <u>"+e.EntityName+"</u> = <b>";if(d.rightFields&&d.rightFields.length>0){var b=d.rightFields[0];c+=b.FieldName+"</b> of <u>"+b.EntityName+"</u>"}return{html:c}});$("#entityRelationshipListBox").jqxListBox({source:a})}function sendMessageHandler(){var a=$("#messageBox").val();if(a&&a.length>0){nuoUserMessageHolder.Message=a;if(nuoUserMessageHolder.CommunicationType%COMMUNICATION_TYPE_RELATIONSHIPS==0){nuoUserMessageHolder.Responses=nuoUserMessageHolder.Message.split(new RegExp("and","i"));currRelMesssageFieldCount=0;sendMessageToEva(false,false,true)}else{sendMessageToEva(true,true,true)}}}function sendMessageToEva(b,d,c){if(d){addMessageToHistory({userName:activeUsername,text:nuoUserMessageHolder.Message,isChart:false})}if(b){nuoUserMessageHolder.CommunicationType=COMMUNICATION_TYPE_DEFAULT;nuoUserMessageHolder.QuestionAlias="Result_"+(currHistoryEndLineNumber);nuoUserMessageHolder.QuestionText=nuoUserMessageHolder.Message}var a="rt47";if(nuoUserMessageHolder.NuoFileLoadOptions){a="rt101"}if(nuoUserMessageHolder.NuoAnalyzeImageOptions){a="rt127"}directCall(a,"NuoUserMessage",nuoUserMessageHolder).done(function(e){if(e.StatusCode&&e.StatusCode===200){nuoUserMessageHolder={};nuoEvaMessageHolder={};nuoConversationResponse=e.Content;if(nuoConversationResponse.NuoEvaMessage&&nuoConversationResponse.NuoEvaMessage.CommunicationType){handleResponseFromEva(nuoConversationResponse)}else{console.log("Something went wrong.");console.log(JSON.stringify(nuoConversationResponse))}}else{}})}function sleep(a){var b=new Promise(function(c){setTimeout(c,a)});return b}async function handleResponseFromEva(a){nuoEvaMessageHolder=a.NuoEvaMessage;passInfoToUserMessage();if(nuoEvaMessageHolder.CommunicationType===COMMUNICATION_TYPE_ERROR){addMessageToHistory({userName:"Eva",text:nuoEvaMessageHolder.Message,isChart:false})}else{if(nuoEvaMessageHolder.CommunicationType===COMMUNICATION_TYPE_EXECUTION_RUNNING){var b;if(nuoEvaMessageHolder.NuoPollingDetails){if(nuoEvaMessageHolder.NuoPollingDetails.EndTimeMillis&&nuoEvaMessageHolder.NuoPollingDetails.EndTimeMillis<=Date.now()){console.log("Time out occured");addMessageToHistory({userName:"Eva",text:"TIME_OUT: I could not get result within maxium allowed time. Please contact the NuoCanvas Support team at support@nuocanvas.com",isChart:false})}else{if(nuoEvaMessageHolder.NuoPollingDetails.StartTimeMillis&&nuoEvaMessageHolder.NuoPollingDetails.StartTimeMillis>Date.now()){b=Date.now()-nuoEvaMessageHolder.NuoPollingDetails.StartTimeMillis}else{b=nuoEvaMessageHolder.NuoPollingDetails.PollingIntervalMillis}}}else{b=3000}b=nuoEvaMessageHolder.NuoPollingDetails.PollingIntervalMillis;console.log("Going to sleep for "+b+" before sending message to Eva");sleep(b);console.log("Awake now and sending message to Eva");sendMessageToEva(false,false,false)}else{if(nuoEvaMessageHolder.CommunicationType===COMMUNICATION_TYPE_RESULT_AVAILABLE){addMessageToHistory({userName:"Eva",text:nuoEvaMessageHolder.QuestionText,isChart:true})}else{if(nuoEvaMessageHolder.CommunicationType==COMMUNICATION_TYPE_RELATIONSHIPS){refreshEntityRelationshipWindow()}else{if(nuoEvaMessageHolder.CommunicationType==COMMUNICATION_TYPE_MAPPING){refreshMapperWindow()}else{getUserChoice()}}}}}}function passInfoToUserMessage(){nuoUserMessageHolder.QuestionAlias=nuoEvaMessageHolder.QuestionAlias;nuoUserMessageHolder.QuestionText=nuoEvaMessageHolder.QuestionText;nuoUserMessageHolder.QuestionHash=nuoEvaMessageHolder.QuestionHash;nuoUserMessageHolder.RuleText=nuoEvaMessageHolder.RuleText;nuoUserMessageHolder.CommunicationType=nuoEvaMessageHolder.CommunicationType;nuoUserMessageHolder.NuoCommonFields=[];nuoUserMessageHolder.NuoFileLoadOptions=nuoEvaMessageHolder.NuoFileLoadOptions;nuoUserMessageHolder.NuoAnalyzeImageOptions=nuoEvaMessageHolder.NuoAnalyzeImageOptions}function getUserChoice(){var b=nuoEvaMessageHolder.CommunicationType;var a=nuoEvaMessageHolder.NuoUserChoices.map(function(d){return d.ChoiceText});var c=nuoEvaMessageHolder.Message;if(b%COMMUNICATION_TYPE_LITERAL==0){a.push(LiteralSuggestionMessage)}if(b%COMMUNICATION_TYPE_FIELD_SUGG==0){a.push(FieldSuggestionMessage)}if(b%COMMUNICATION_TYPE_UNARY_SUGG==0){a.push(UnarySuggestionMessage)}if(b%COMMUNICATION_TYPE_QUESTION_SUGG==0){a.push(QuestionSuggestionMessage)}if(b%COMMUNICATION_TYPE_EXECUTION_STARTED==0){a=[];a.push(SaveResultSuggestionMessage);a.push(GetResultSuggestionMessage);c=c.replace(new RegExp("<br>","g"),"")}addMessageToHistory({userName:"Eva",text:c,isChart:false});$("#userChoiceListBox").jqxListBox({source:a});$("#userChoiceMessage").html(nuoEvaMessageHolder.Message);$("#userChoiceWindow").jqxWindow("open")}function updUserSuggWindowElements(){var e=$("#userChoiceListBox").jqxListBox("getSelectedItems");var d=$("#userChoiceListBox").jqxListBox("getItems");var c=-1;if(e.length>0){c=getCommunicationType(e[0].label)}nuoUserMessageHolder.CommunicationType=c;var a=null;if(c==COMMUNICATION_TYPE_GET_RESULT){nuoUserMessageHolder.Message=e[0].label;if(nuoUserMessageHolder.Message===SaveResultSuggestionMessage){nuoUserMessageHolder.Message="Save the result as <mark>"+nuoUserMessageHolder.QuestionAlias+"</mark> and get me  the results.";$("#userSuggestionTextBox2").hide();$("#userSuggestionTextBox1").val("For example, Preferred_Customer_Analysis_Result.");a="Please name this result so that you can ask questions as if it were a table.</i>";$("#userSuggestionWindow").jqxWindow("setTitle",nuoEvaMessageHolder.Message)}else{if(nuoUserMessageHolder.Message===GetResultSuggestionMessage){sendMessageToEva(false,false,true)}}}else{if(c==COMMUNICATION_TYPE_FIELD_SUGG){$("#userSuggestionTextBox2").hide();$("#userSuggestionTextBox1").val("For example, name of Customer.");a=nuoEvaMessageHolder.Message;$("#userSuggestionWindow").jqxWindow("setTitle","What is your suggestion for the column?")}else{if(c==COMMUNICATION_TYPE_UNARY_SUGG){$("#userSuggestionTextBox2").show();$("#userSuggestionTextBox1").val("For example, name of Customer.");$("#userSuggestionTextBox2").val("For example, Eva.");$("#userSuggestionWindow").jqxWindow("setTitle","What is your suggestion for the expression?");a=nuoEvaMessageHolder.Message+"Please note, expression consist of two parts as following<br><br><i>name of column</i> <br><span>     =<br><i> filter on that column</i></span><br><br>"}else{if(c==COMMUNICATION_TYPE_QUESTION_SUGG){$("#userSuggestionTextBox2").hide();$("#userSuggestionTextBox1").val("For example, name of companies with revenue above 10K");a=nuoEvaMessageHolder.Message;$("#userSuggestionWindow").jqxWindow("setTitle","What question does explain the column?")}else{if(c==COMMUNICATION_TYPE_LITERAL){nuoUserMessageHolder.Responses=[nuoEvaMessageHolder.RuleText];nuoUserMessageHolder.Message=e[0].label;sendMessageToEva(false,false,true)}else{var b=nuoEvaMessageHolder.NuoUserChoices.find(function(f){return f.ChoiceText===e[0].label}).ChoiceIndex;nuoUserMessageHolder.Responses=[b];nuoUserMessageHolder.Message=e[0].label;sendMessageToEva(false,false,true)}}}}}if(a){$("#userSuggestionMsg").html(a);$("#userSuggestionWindow").jqxWindow("open")}}function userSuggConfirmationHandler(){if(nuoUserMessageHolder.CommunicationType===COMMUNICATION_TYPE_UNARY_SUGG){nuoUserMessageHolder.Responses=[$("#userSuggestionTextBox1").val(),$("#userSuggestionTextBox2").val()];nuoUserMessageHolder.Message=nuoUserMessageHolder.Responses.join(" = ")}else{if(nuoUserMessageHolder.CommunicationType===COMMUNICATION_TYPE_GET_RESULT){nuoUserMessageHolder.ResultTableName=$("#userSuggestionTextBox1").val();nuoUserMessageHolder.Message="Save the result as <mark>"+nuoUserMessageHolder.QuestionAlias+"</mark> and get the results."}else{nuoUserMessageHolder.Responses=[$("#userSuggestionTextBox1").val()];nuoUserMessageHolder.Message=nuoUserMessageHolder.Responses[0]}}sendMessageToEva(false,false,true);$("#userSuggestionWindow").jqxWindow("close")}function addMessageToHistory(a){currHistoryEndLineNumber+=1;a.lineNumber=currHistoryEndLineNumber;a.topics=getSelectedTopics();a.messageTimeMillis=Date.now();historyMessages.unshift(a);addRowToHistoryFeed(a);$("#messageBox").val("");if(a.isChart){if(nuoConversationResponse.NuoConversationResult){a.Result={data:nuoConversationResponse.NuoConversationResult.Data,metadata:nuoConversationResponse.NuoConversationResult.Metadata}}if(nuoConversationResponse.NuoConversationProfilingResult){a.ProfilingResult={data:nuoConversationResponse.NuoConversationProfilingResult.Data,metadata:nuoConversationResponse.NuoConversationProfilingResult.Metadata}}a.chartType=CHART_TYPE_AREA;drawMessageChart(a);saveToHistory();renderHistorySection()}else{a.Result={data:[],metadata:[]};a.ProfilingResult={data:[],metadata:[]}}}function drawMessageChart(b){if(b.Result&&b.Result.data&&b.Result.metadata){var a="#historyChartComboBox"+b.lineNumber;$(a).jqxComboBox({source:ChartTypes,width:150,height:"98%",selectedIndex:0,theme:jqWidgetThemeName});$(a).on("select",function(f){var d=f.args;if(d!=undefined){var e=f.args.item;if(e!=null){var c=$(this).attr("id");var g=c[c.length-1];b.chartType=e.label;drawChart("historyMessageChart"+b.lineNumber,b.chartType,b.text,b.Result.data,b.Result.metadata)}}})}$("#historyMessageTabs"+b.lineNumber).jqxTabs({width:"100%",height:"100%",selectionTracker:true,animationType:"fade",theme:jqWidgetThemeName});if(b.Result&&b.Result.data&&b.Result.metadata){drawChart("historyMessageDataGrid"+b.lineNumber,CHART_TYPE_DATA_TABLE,b.text,b.Result.data,b.Result.metadata);$(a).jqxComboBox("selectItem",b.chartType)}else{$("#historyMessageDataGrid"+b.lineNumber).html("<i>No chart available for this response.</i>")}if(b.ProfilingResult&&b.ProfilingResult.data&&b.ProfilingResult.metadata){drawChart("historyMessageProfilingGrid"+b.lineNumber,CHART_TYPE_DATA_TABLE,b.text,b.ProfilingResult.data,b.ProfilingResult.metadata)}else{$("#historyMessageProfilingGrid"+b.lineNumber).html("<i>No profiling results available for this response.</i>")}}function getCommunicationType(b){var a=-1;if(b==LiteralSuggestionMessage){a=COMMUNICATION_TYPE_LITERAL}else{if(b==FieldSuggestionMessage){a=COMMUNICATION_TYPE_FIELD_SUGG}else{if(b==UnarySuggestionMessage){a=COMMUNICATION_TYPE_UNARY_SUGG}else{if(b==QuestionSuggestionMessage){a=COMMUNICATION_TYPE_QUESTION_SUGG}else{if(b==SaveResultSuggestionMessage||b==GetResultSuggestionMessage){a=COMMUNICATION_TYPE_GET_RESULT}else{a=COMMUNICATION_TYPE_CHOICE}}}}}return a}function loadIndexTree(){$("#indexTree").jqxTree({height:"100%",width:"100%",theme:jqWidgetThemeName});var a=[{label:"Sales",expanded:true,items:[{label:"Inside"}]},{label:"Marketing",expanded:true,items:[{label:"Online",items:[{label:"Facebook"}]},{label:"Media"}]},{label:"Manufacturing"}];$("#indexTree").jqxTree({source:a});$("#indexTree").jqxTree("selectItem",$("#indexTree").find("li:first")[0])}function addRowToHistoryFeed(a){$("#historyBody").prepend(getHistoryRowTag(a));if(!a.isChart){saveToHistory();renderHistorySection()}}function renderHistorySection(){var a=historyMessages;var b=getSelectedTopics();if(b.length>0&&historyMessages[0].lineNumber>0){a=a.filter(function(d){var c=b.map(function(e){if(d.topics.indexOf(e)<0){return 1}else{return 0}}).reduce(function(e,f){return e+f});return c==0})}if(a.length==0){a.push(emptyMessage)}$("#historyBody").html(a.map(function(c){return getHistoryRowTag(c)}).join("\n"));a.forEach(function(c){if(c.isChart){drawMessageChart(c)}})}function getHistoryRowTag(p){var q=p.lineNumber;var r=p.messageTimeMillis;var l="";if(p.isChart===true){l="chartRow"}else{l="textRow"}var a="<div class = 'historyRow "+l+"'>";var f="<div id='historyLineNumberContainer"+q+"' class='historyLineNumberContainer'>";f+="<div id='historyLineNumber"+q+"' class='historyLineNumber'>"+q+"</div>";f+="</div>";var e="<div id='historyMessageContainer"+q+"' class='historyMessageContainer containerOuter' style='500px'>";var n="<div id='historyMessageHeader"+q+"' class ='historyMessageHeader'>";var m="./public/assets/images/Eva_512x512.png";if(p.userName===activeUsername){m=profileImageUrl}var k="<img width='48px' height='48px' src='"+m+"'/>";var h="<div id='historyUserImage"+q+"' class='historyUserImage'>"+k+"</div>";var c="<div id='historyUserNameAndTime"+q+"' class='historyUserNameAndTime'>";var i="<div id='historyUserName"+q+"' class='historyUserName'>"+p.userName+"</div>";var j="<div id='historyMessageTime"+q+"' class='historyMessageTime'>"+timeSince(r)+"</div>";c+=i;c+=j;c+="</div>";var o=0;var d="<div id='historyMessageTopicContainer"+q+"' class='historyMessageTopicContainer'>"+p.topics.map(function(s){o+=1;return"<div id='historyMessageTopic"+o+"' class='historyMessageTopic'>"+s+"</div>"}).join("")+"</div>";n+=h;n+=c;n+=d;n+="</div>";var b="<div id='historyMessageInfo"+q+"' class='historyMessageInfo "+l+"'>";var g="";if(p.isChart===true){b+="<div id='historyMessageTabs"+q+"' class='historyMessageTabs'>";b+="<ul><li>Visualization</li><li>Data</li><li>Profiling Results</li></ul>";b+="<div id='historyMessageChartContainer"+q+"' class='historyMessageChartContainer'>";b+="<div id='historyMessageToolbar"+q+"' class='historyMessageToolbar'>";b+="<div id='historyChartComboBox"+q+"' class='historyChartComboBox'></div>";b+="</div>";b+="<div id='historyMessageChart"+q+"' class='historyMessageChart'></div>";b+="</div>";b+="<div id='historyMessageDataGrid"+q+"' class='historyMessageDataGrid'></div>";b+="<div id='historyMessageProfilingGrid"+q+"' class='historyMessageProfilingGrid'></div>";b+="</div>"}else{b+="<div id='historyMessageContent"+q+"' class='historyMessageContent containerInner'>"+p.text+"</div>"}b+="</div>";e+=n;e+=b;e+="</div>";a+=f;a+=e;a+="</div>";return a}function formatDate(a){var c=["January","February","March","April","May","June","July","August","September","October","November","December"];var g=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var e=a.getDay();var b=a.getDate();var f=a.getMonth();var d=a.getFullYear();return g[e]+", "+c[f]+" "+b+", "+d}function timeSince(b){var c=Math.floor((Date.now()-b)/1000);var a=Math.floor(c/(60*60*24*30*12));if(a>1){return a+" years ago"}else{if(a==1){return a+" year ago"}}a=Math.floor(c/(60*60*24*30));if(a>1){return a+" months ago"}else{if(a==1){return a+" month ago"}}a=Math.floor(c/(60*60*24*7));if(a>1){return a+" weeks ago"}else{if(a==1){return a+" week ago"}}a=Math.floor(c/(60*60*24));if(a>1){return a+" days ago"}else{if(a==1){return a+" day ago"}}a=Math.floor(c/(60*60));if(a>1){return a+" hours ago"}else{if(a==1){return a+" hour ago"}}a=Math.floor(c/60);if(a>1){return a+" minutes ago"}else{if(a==1){return a+" minute ago"}}a=Math.floor(c);if(a>1){return a+" seconds ago"}else{if(a==1){return a+" second ago"}else{return"Just now"}}}function formatTime(a){var b=a.getHours();var d=a.getMinutes();var c=(b>11)?"PM":"AM";if(b>12){b-=12}else{if(b==0){b="12"}}if(d<10){d="0"+d}return b+":"+d+" "+c}function formateCurrency(a){return"EUR "+parseFloat(a).toFixed(6).replace(".",",")}function saveToHistory(){if(!isHistorySaving){if(lastSaveMarker<currHistoryEndLineNumber){var b=historyMessages.filter(function(c){return c.lineNumber>lastSaveMarker});var a=b.map(function(c){return c.lineNumber});isHistorySaving=true;directCall("rt37","NuoHistoryPaginationRequest",{StartLineNumber:lastSaveMarker+1,EndLineNumber:currHistoryEndLineNumber,NuoHistoryMessages:b.map(function(d){var c={LineNumber:d.lineNumber,Content:JSON.stringify(d)};return c})}).done(function(d){isHistorySaving=false;if(d.StatusCode&&d.StatusCode===200){var c=parseInt(d.Content);if(c>0){lastSaveMarker=parseInt(c)}}else{}})}}}function readFromHistory(){if(!isHistoryLoading){var a=historyMessages.map(function(c){return c.lineNumber});var b=Math.min.apply(Math,a)-1;if(a.length==1){b=-1}if(b==-1&&a.length==1){historyMessages=[]}if(b>1||historyMessages.length==0){isHistoryLoading=true;directCall("rt41","NuoHistoryPaginationRequest",{EndLineNumber:b}).done(function(c){isHistoryLoading=false;if(c.StatusCode&&c.StatusCode===200){if(c&&c.Content&&c.Content.NuoHistoryMessages&&c.Content.NuoHistoryMessages.length>0){loadedMessages=c.Content.NuoHistoryMessages.sort(function(d,e){if(d.LineNumber>e.LineNumber){return -1}if(d.LineNumber<e.LineNumber){return 1}return 0}).map(function(d){return JSON.parse(d.Content)});historyMessages=historyMessages.concat(loadedMessages);currHistoryStartLineNumber=c.Content.StartLineNumber;currHistoryEndLineNumber=c.Content.EndLineNumber;lastSaveMarker=c.Content.EndLineNumber;renderHistorySection()}}else{}})}}}function deleteFileSelectionHandler(){var b=$("#customerFilesTable").jqxGrid("getselectedrowindexes");if(confirm("You have selected "+b.length+" file. Are you sure you want to delete them all?")){var b=$("#customerFilesTable").jqxGrid("getselectedrowindexes");var a=[];b.map(function(c){return $("#customerFilesTable").jqxGrid("getrowdata",c)}).forEach(function(c){if(c.isDirectory){a=a.concat(activeCustomerFiles.filter(function(f){var g=encodeURI(c.fileLabel)+"/";var e=getParentFilePath();if(e&&e.length>0&&e!=="/"){g=e+g}return f.fileName.startsWith(g)&&!f.fileName.endsWith(systemFileLabel)}).map(function(e){return e.fileName}))}else{var d=c.fileName;if(!d.endsWith(systemFileLabel)){a.push(d)}}});deleteFiles(a);$("#customerFilesTable").jqxGrid("clearselection")}}function deleteFiles(a){var c=a.map(function(e){var d={FileName:e};return d});var b=getParentFilePath();$("#customerFilePath").css("background-color","yellow");directCall("rt89","NuoFileContentList",c).done(function(d){if(d.StatusCode&&d.StatusCode===200){if(activeCustomerFiles){activeCustomerFiles=activeCustomerFiles.filter(function(e){return a.filter(function(f){return e.fileName===f}).length==0})}loadCustomerFilesTable(b);$("#customerFilePath").css("background-color","white")}else{}})}function newFolderButtonHandler(){var d=prompt("Folder Name","New Folder");if(d!=null&&d.trim().length>0){var a=getParentFilePath();var b={author:activeUsername,sizeBytes:0,dateCreatedMillis:Date.now(),dateModifiedMillis:Date.now()};var c=encodeURI(d)+"/"+systemFileLabel;if(a&&a.length>0&&a!=="/"){c=a+c}b.fileName=c;console.log(JSON.stringify(b));activeCustomerFiles.push(b);loadCustomerFilesTable(a)}}function evaFilesButtonHandler(){loadCustomerDirWindow(activeUsername)}function profileImageSelectionHandler(d){var c=d.target.files;if(c.length>0){var b=c[0];var a=new FileReader();a.onload=(function(e){return function(){var f="ProfileImage/Latest";var g={author:activeUsername,sizeBytes:e.size,dateCreatedMillis:Date.now(),dateModifiedMillis:Date.now()};g.fileName=f;f=f;directCall("rt79","NuoFileContent",{FileName:f,ContentType:e.type}).done(function(h){if(h.StatusCode&&h.StatusCode===200){$.ajax({type:"PUT",url:h.Content,headers:{"Content-Disposition":'attachment; filename="'+e.name+'"'},contentType:e.type,processData:false,data:e,success:function(){console.log(JSON.stringify(g));profileImageUrl=URL.createObjectURL(e);$("#profileImageFile").attr("src",profileImageUrl)},error:function(i){alert("File "+e.name+" could not be uploaded. If this is not because of your betwork, please contact NuoCanvas support.");console.log(i)}});return false}else{}})}})(b);a.readAsDataURL(b)}}function uploadFileSeletionHandler(f){var e=f.target.files;var b=0;for(var d=0,c;c=e[d];d++){var a=new FileReader();a.onload=(function(g){return function(){var h=encodeURI(g.name);var j={author:activeUsername,sizeBytes:g.size,dateCreatedMillis:Date.now(),dateModifiedMillis:Date.now()};var i=getParentFilePath();if(i&&i.length>0&&i!=="/"){h=i+h}j.fileName=h;h=h;$("#customerFilePath").css("background-color","green");$("#customerFilePath").css("color","white");b+=1;directCall("rt79","NuoFileContent",{FileName:h,ContentType:g.type}).done(function(k){if(k.StatusCode&&k.StatusCode===200){$.ajax({type:"PUT",url:k.Content,headers:{"Content-Disposition":'attachment; filename="'+g.name+'"'},contentType:g.type,processData:false,data:g,success:function(){console.log(JSON.stringify(j));activeCustomerFiles.push(j);loadCustomerFilesTable(i);b-=1;if(b==0){$("#customerFilePath").css("background-color","white");$("#customerFilePath").css("color","black")}},error:function(l){alert("File "+g.name+" could not be uploaded. If this is not because of your betwork, please contact NuoCanvas support.");console.log(l);b-=1;if(b==0){$("#customerFilePath").css("background-color","white");$("#customerFilePath").css("color","black")}}});return false}else{}})}})(c);a.readAsDataURL(c)}}function getParentFilePath(){var a=$("#customerFilesTable").jqxGrid("getrowdata",0);if(a){return a.parentPath}else{return""}}function loadCustomerDirWindow(a){var c=$(window).width();var e=$(window).height();var b=800;var d=500;$("#customerDirWindow").jqxWindow({width:b,height:d,isModal:true,resizable:true,autoOpen:false,position:{x:(c/2)-300,y:100},theme:jqWidgetThemeName});$("#customerDirWindow").jqxWindow("setTitle","Files");$("#customerFilePath").html("/");loadCustomerFilesTable("");$("#customerDirWindow").jqxWindow("open")}function loadCustomerFilesTable(a,b){if(b||!activeCustomerFiles||activeCustomerFiles.length==0){directCall("rt97").done(function(c){if(c.StatusCode&&c.StatusCode===200){console.log("Get files status= "+c.Status);if(c.Content&&c.Content.NuoEvaFiles){activeCustomerFiles=c.Content.NuoEvaFiles;renderCustomerFilesTable(a)}else{$("#customerFilesTable").html("I was not able to serve your request. Please contact support");$("#customerFilesTable").show()}}else{$("#customerFilesTable").html("I was not able to serve your request. Please contact support");$("#customerFilesTable").show()}})}else{renderCustomerFilesTable(a)}}function renderCustomerFilesTable(a){var b=[{text:"File Name",dataField:"fileLabel",width:"45%",height:20},{text:"Size",dataField:"sizeLabel",width:"10%",cellsalign:"right",height:20},{text:"Type",dataField:"fileType",width:"15%",height:20},{text:"Date Uploaded",dataField:"dateCreated",width:"25%",height:20,cellsformat:"yyyy-MM-dd  HH:mm:ss.fff"}];renderJqxGrid("#customerFilesTable",transformCustomerFiles(activeCustomerFiles,a),b);$("#customerFilesTable").show();$("#customerFilePath").show()}function transformCustomerFiles(c,a){var b=[];c.map(function(d){var f=d.fileName;var e={};if(!a||a.length==0||(f.indexOf(a)>=0&&f.length>a.length)){e.fileName=f;e.parentPath=a;if(f.indexOf("/",a.length)>=0){e.fileLabel=decodeURI(f.substring(a.length,f.indexOf("/",a.length+1)));e.filePath=f.substring(0,f.indexOf("/",a.length+1)+1);e.isDirectory=true;e.fileType="Folder"}else{e.fileLabel=decodeURI(f.substring(a.length));e.filePath=f;e.isDirectory=false;if(e.fileLabel.indexOf(".")>0){e.isDirectory=false;e.fileType=e.fileLabel.substring(e.fileLabel.lastIndexOf(".")+1).toUpperCase()+" File"}}e.dateCreated=new Date(parseInt(d.dateCreatedMillis));e.sizeBytes=parseInt(d.sizeBytes);e.sizeLabel=getSizeLabel(e.sizeBytes);return e}else{return e}}).filter(function(d){return d.fileLabel}).sort(function(d,e){if(d.dateModified>e.dateModified){return -1}if(d.dateModified<e.dateModified){return 1}return 0}).forEach(function(d){var e=b.find(function(f){return f.fileLabel===d.fileLabel});if(!e){b.push(d)}else{e.sizeBytes+=d.sizeBytes;e.sizeLabel=getSizeLabel(e.sizeBytes)}});return b}function getSizeLabel(a){if(a>=1024*1024*1024*1024){return(a/1024/1024/1024/1024).toFixed(2)+" TB"}else{if(a>=1024*1024*1024){return(a/1024/1024/1024).toFixed(2)+" GB"}else{if(a>=1024*1024){return(a/1024/1024).toFixed(2)+" MB"}else{if(a>=1024){return(a/1024).toFixed(2)+" KB"}else{return a+" B"}}}}}function addCustomerTableEventHandlers(){$("#customerFileUpButton").on("click",function(b){var c=$("#customerFilesTable").jqxGrid("getrowdata",0);var a="";if(c.isDirectory){a=c.parentPath.substring(0,c.parentPath.length-1).substring(0,c.parentPath.substring(0,c.parentPath.lastIndexOf("/")).lastIndexOf("/")+1)}else{a=c.parentPath.substring(0,c.parentPath.substring(0,c.parentPath.lastIndexOf("/")).lastIndexOf("/")+1)}loadCustomerFilesTable(a);if(a.length==0){$("#customerFilePath").html("/")}else{$("#customerFilePath").html(decodeURI(a))}$("#customerFilesTable").jqxGrid("clearselection")});$("#customerFileRefreshButton").on("click",function(a){loadCustomerFilesTable("",true)});$("#customerFilesTable").on("rowdoubleclick",function(d){var c=d.args.rowindex;var e=$("#customerFilesTable").jqxGrid("getrowdata",c);if(e.isDirectory){loadCustomerFilesTable(e.filePath);$("#customerFilePath").html(decodeURI(e.filePath));if(e.filePath.length==0){$("#customerFilePath").html("/")}}else{var a=encodeURI(e.fileLabel);if(!a.endsWith(systemFileLabel)){var b=e.parentPath;if(b&&b.length>0&&b!=="/"){a=b+a}a=a;directCall("rt83","NuoFileContent",{FileName:a}).done(function(g){if(g.StatusCode&&g.StatusCode===200){var f=document.getElementById("downloadTag");f.setAttribute("href",g.Content);f.click()}else{}})}}$("#customerFilesTable").jqxGrid("clearselection")})}function evaProgressButtonHandler(){loadProgressMonitorWindow(activeUsername)}function loadProgressMonitorWindow(a){var c=$(window).width();var e=$(window).height();var b=800;var d=500;$("#progressMonitorWindow").jqxWindow({width:b,height:d,isModal:true,resizable:true,autoOpen:false,position:{x:(c/2)-300,y:100},theme:jqWidgetThemeName});$("#progressMonitorWindow").jqxWindow("setTitle","Analysis Progress");loadProgressMonitorTable(true);$("#progressMonitorWindow").jqxWindow("open")}function loadProgressMonitorTable(a){if(a||!activeProgressMonitors||activeProgressMonitors.length==0){var b=null;if(a){b=directCall("rt113")}else{b=directCall("rt113")}b.done(function(c){if(c.StatusCode&&c.StatusCode===200){console.log("Get Progress status= "+c.Status);if(c.Content&&c.Content.NuoQuestionMonitorList){activeProgressMonitors=c.Content.NuoQuestionMonitorList;renderProgressMonitorTable()}else{$("#progressMonitorTable").html("I was not able to serve your request. Please contact support");$("#progressMonitorTable").show()}}else{$("#progressMonitorTable").html("I was not able to serve your request. Please contact support");$("#progressMonitorTable").show()}})}else{renderProgressMonitorTable()}}function renderProgressMonitorTable(){var b=[];if(activeProgressMonitors&&activeProgressMonitors.length>0){var b=[{text:"Alias",dataField:"QuestionAlias",width:"20%",height:20},{text:"Message",dataField:"QuestionText",width:"20%",height:20},{text:"Progress",dataField:"Progress",width:"20%",height:20,cellsrenderer:function(f,e,d){var c='<div style="margin-top:5px;">';c+='<div style="background: #058dc7; float: left; width: '+d+'px; height: 16px;"></div>';c+='<div style="margin-left: 5px; float: left;">'+parseInt(d).toString()+"%</div>";c+="</div>";return c}},{text:"StartTime",dataField:"StartTimeDate",width:"20%",height:20},{text:"Duration",dataField:"Duration",width:"20%",height:20}];var a=activeProgressMonitors.map(function(c){if(c.TotalSteps&&c.TotalSteps>0){c.Progress=c.StepsCompleted/c.TotalSteps*100}else{c.Progress=0}if(c.StartTimeMillis){c.StartTimeDate=new Date(c.StartTimeMillis)}else{c.StartTimeDate="N/A"}if(c.StartTimeMillis&&c.EndTimeMillis){if(c.Progress<100){c.Duration=getReadableDuration(Date.now()-c.StartTimeMillis)}else{c.Duration=getReadableDuration(c.EndTimeMillis-c.StartTimeMillis)}}else{c.Progress="N/A"}return c});renderJqxGrid("#progressMonitorTable",a,b)}$("#progressMonitorTable").show()}function addProgressMonitorEventHandlers(){$("#progressMonitorRefreshButton").on("click",function(a){loadProgressMonitorTable(true)})}function deleteTableSelectionHandler(){var a=$("#storageExplorerTable").jqxGrid("getselectedrowindexes");if(confirm("You have selected "+a.length+" tables. Are you sure you want to delete them all?")){var b=a.map(function(c){return $("#storageExplorerTable").jqxGrid("getrowdata",c)}).filter(function(c){return !c.FieldName&&c.EntityName&&c.EntityName.length>0}).map(function(d){var c={DatasetName:"",EntityName:d.EntityName};return c});$("#storageExplorerTableName").css("background-color","yellow");directCall("rt109","NuoEntities",b).done(function(c){if(c.StatusCode&&c.StatusCode===200){console.log("Delete table status= "+c.Content);activeEvaTables=activeEvaTables.filter(function(d){return b.filter(function(e){return e.EntityName===d.EntityName}).length==0});loadStorageExplorerTable();$("#storageExplorerTableName").css("background-color","white")}else{}});$("#storageExplorerTable").jqxGrid("clearselection")}}function evaTablesButtonHandler(){loadStorageExplorerWindow(activeUsername)}function loadStorageExplorerWindow(a){var c=$(window).width();var e=$(window).height();var b=800;var d=500;$("#storageExplorerWindow").jqxWindow({width:b,height:d,isModal:true,resizable:true,autoOpen:false,position:{x:(c/2)-300,y:100},theme:jqWidgetThemeName});$("#storageExplorerWindow").jqxWindow("setTitle","Tables");loadStorageExplorerTable();$("#storageExplorerWindow").jqxWindow("open")}function loadStorageExplorerTable(a,b){if(b||!activeEvaTables||activeEvaTables.length==0){var c=null;if(b){c=directCall("rt107")}else{c=directCall("rt103")}$("#storageExplorerTableName").css("background-color","yellow");c.done(function(d){if(d.StatusCode&&d.StatusCode===200){console.log("Get tables status= "+d.Status);if(d.Content&&d.Content.NuoEvaTables){activeEvaTables=d.Content.NuoEvaTables;renderStorageExplorerTable(a)}else{$("#storageExplorerTable").html("I was not able to serve your request. Please contact support");$("#storageExplorerTable").show()}}else{$("#storageExplorerTable").html("I was not able to serve your request. Please contact support");$("#storageExplorerTable").show()}})}else{renderStorageExplorerTable(a)}}function renderStorageExplorerTable(a){var d=[];if(a&&a.trim().length>0&&activeEvaTables&&activeEvaTables.length>0){var c=activeEvaTables.filter(function(f){return f.EntityName===a});if(c&&c.length>0){var d=[{text:"Column Name",dataField:"FieldName",width:"30%",height:20},{text:"Data Type",dataField:"DataType",width:"30%",height:20}];var b=c[0];renderJqxGrid("#storageExplorerTable",b.Fields,d)}}else{if(activeEvaTables&&activeEvaTables.length>0){var d=[{text:"Table Name",dataField:"EntityName",width:"20%",height:20},{text:"Size",dataField:"SizeLabel",cellsalign:"right",width:"12%",height:20},{text:"Total Rows",dataField:"SizeRows",cellsalign:"right",width:"12%",height:20},{text:"Created At",dataField:"CreatedAt",width:"25%",height:20,cellsformat:"yyyy-MM-dd  HH:mm:ss.fff"},{text:"Last Modified on",dataField:"LastModifiedOn",width:"25%",height:20,cellsformat:"yyyy-MM-dd  HH:mm:ss.fff"}];var e=activeEvaTables.map(function(f){f.SizeRows=parseInt(f.SizeRows);f.SizeLabel=getSizeLabel(parseInt(f.SizeBytes));f.CreatedAt=new Date(parseInt(f.CreationTime));f.LastModifiedOn=new Date(parseInt(f.LastModifiedTime));return f});renderJqxGrid("#storageExplorerTable",e,d)}}$("#storageExplorerTable").show();if(a&&a.length>0){$("#storageExplorerTableName").html(a)}else{$("#storageExplorerTableName").html("Tables")}$("#storageExplorerTableName").show();$("#storageExplorerTableName").css("background-color","white")}function addStorageExplorerEventHandlers(){$("#storageExplorerUpButton").on("click",function(b){var c=$("#storageExplorerTable").jqxGrid("getrowdata",0);var a="";if(c.FieldName){loadStorageExplorerTable(null,false)}$("#storageExplorerTable").jqxGrid("clearselection")});$("#storageExplorerRefreshButton").on("click",function(a){loadStorageExplorerTable(null,true)});$("#storageExplorerTable").on("rowdoubleclick",function(b){var a=b.args.rowindex;var c=$("#storageExplorerTable").jqxGrid("getrowdata",a);if(!c.FieldName&&c.EntityName&&c.EntityName.length>0){loadStorageExplorerTable(c.EntityName,false)}$("#storageExplorerTable").jqxGrid("clearselection")})}function renderJqxGrid(c,a,h,d,b){var e={localData:a,dataType:"json"};var g=new $.jqx.dataAdapter(e);var f={columnsResize:true,altRows:false,sortable:true,selectionMode:"checkbox",source:g,columns:h,width:"98%",height:"80%",scrollmode:"logical",theme:jqWidgetThemeName};if(b){f.editable=true}if(d){f.pageable=true;f.pagerMode="advanced"}$(c).jqxGrid(f)}function createPlatformMetrics(){var a=function(c,b){if(b<55){return"<span style='color: #333;'>"+c+"</span>"}return"<span style='color: #fff;'>"+c+"</span>"};$("#metricDataProcessedProgress").jqxProgressBar({animationDuration:0,showText:true,renderText:a,template:"primary"});$("#metricStorageGBProgress").jqxProgressBar({animationDuration:0,showText:true,renderText:a,template:"primary"});$("#metricModelTrainingProgress").jqxProgressBar({animationDuration:0,showText:true,renderText:a,template:"primary"});$("#metricPredictionsProgress").jqxProgressBar({animationDuration:0,showText:true,renderText:a,template:"primary"});$("#metricImageAnalysisProgress").jqxProgressBar({animationDuration:0,showText:true,renderText:a,template:"primary"});$("#metricDataProcessedProgress").val(60);$("#metricStorageGBProgress").val(15);$("#metricModelTrainingProgress").val(32);$("#metricPredictionsProgress").val(85);$("#metricImageAnalysisProgress").val(72)}function getReadableDuration(c){var b=0;var d=0;var a=c/1000;if(a>=3600){b=parseInt(a/3600);a-=b*3600}if(a>=60){d=parseInt(a/60);a-=d*60}return b+"h:"+d+"m:"+parseInt(a)+"s"}const CHART_TYPE_DATA_TABLE="Data Table";const CHART_TYPE_AREA="Area Chart";const CHART_TYPE_BAR="Bar Chart";const CHART_TYPE_BUBBLE="Bubble Chart";const CHART_TYPE_CALENDAR="Calendar Chart";const CHART_TYPE_CANDLESTICK="Candlestick Chart";const CHART_TYPE_COLUMN="Column Chart";const CHART_TYPE_DONUT="Donut Chart";const CHART_TYPE_GANTT="Gantt Chart";const CHART_TYPE_HISTOGRAM="Histogram";const CHART_TYPE_LINE="Line Chart";const CHART_TYPE_MAP="Map";const CHART_TYPE_PIE="Pie Chart";const CHART_TYPE_SANKEY="Sankey Diagram";const CHART_TYPE_SCATTER="Scatter Plot";const CHART_TYPE_STEPPEDAREA="SteppedArea Chart";const ChartTypes=[CHART_TYPE_AREA,CHART_TYPE_BAR,CHART_TYPE_BUBBLE,CHART_TYPE_CALENDAR,CHART_TYPE_CANDLESTICK,CHART_TYPE_COLUMN,CHART_TYPE_DONUT,CHART_TYPE_GANTT,CHART_TYPE_HISTOGRAM,CHART_TYPE_LINE,CHART_TYPE_MAP,CHART_TYPE_PIE,CHART_TYPE_SANKEY,CHART_TYPE_SCATTER,CHART_TYPE_STEPPEDAREA];function drawChart(c,d,g,f,b){var a={title:"",height:"100%",width:"100%",backgroundColor:{fill:"transparent"}};var h=false;if(d===CHART_TYPE_DATA_TABLE){h=true}var e=prepareChartData(b,f,h);switch(d){case CHART_TYPE_DATA_TABLE:drawDataTable(c,a,b,f);break;default:drawGoogleChart(c,d,a,e)}}function drawGoogleChart(b,d,a,e){var c=null;switch(d){case CHART_TYPE_AREA:c=new google.visualization.AreaChart(document.getElementById(b));break;case CHART_TYPE_BAR:a.bars="horizontal";case CHART_TYPE_COLUMN:a=google.charts.Bar.convertOptions(a);c=new google.charts.Bar(document.getElementById(b));break;case CHART_TYPE_BUBBLE:c=new google.visualization.BubbleChart(document.getElementById(b));break;case CHART_TYPE_CALENDAR:c=new google.visualization.Calendar(document.getElementById(b));break;case CHART_TYPE_CANDLESTICK:c=new google.visualization.CandlestickChart(document.getElementById(b));break;case CHART_TYPE_DONUT:a.pieHole=0.4;case CHART_TYPE_PIE:c=new google.visualization.PieChart(document.getElementById(b));break;case CHART_TYPE_GANTT:c=new google.visualization.Gantt(document.getElementById(b));break;case CHART_TYPE_HISTOGRAM:c=new google.visualization.Histogram(document.getElementById(b));break;case CHART_TYPE_LINE:a=google.charts.Line.convertOptions(a);c=new google.charts.Line(document.getElementById(b));break;case CHART_TYPE_MAP:a.showTooltip=true;a.showInfoWindow=true;c=new google.visualization.Map(document.getElementById(b));break;case CHART_TYPE_SANKEY:c=new google.visualization.Sankey(document.getElementById(b));break;case CHART_TYPE_SCATTER:a.trendlines={0:{type:"exponential",visibleInLegend:true}};a=google.charts.Scatter.convertOptions(a);c=new google.charts.Scatter(document.getElementById(b));break;case CHART_TYPE_STEPPEDAREA:a.isStacked=true;c=new google.visualization.SteppedAreaChart(document.getElementById(b));break}c.draw(e,a)}function prepareChartData(a,c,d){if(d){return getChartRows(a,c)}else{var b=new google.visualization.DataTable();b.addRows(getChartRows(a,c,b));return b}}function drawDataTable(c,b,e,g){var d=g.map(function(k){var i=0;var j={};k.forEach(function(l){var m=e[i].DataType;j[e[i].FieldName]=convertToChartColumn(m,l).value;i+=1});return j});var a=getDataTableFields(e);var f={localData:d,dataType:"array",dataFields:a};var h=new $.jqx.dataAdapter(f);$("#"+c).jqxGrid({width:b.width,height:b.height,source:h,pageable:true,altRows:true,sortable:true,filterable:true,filtermode:"excel",columnsresize:true,autoshowfiltericon:false,columns:a.map(function(j){var i={text:j.name,dataField:j.name,width:200};return i}),theme:jqWidgetThemeName})}function getChartRows(b,d,a){var e=true;var c=d.map(function(i){var g=[];for(var f=0;f<b.length;f++){var h=convertToChartColumn(b[f].DataType,i[f]);if(e&&a){a.addColumn(h.dataType,b[f].FieldName)}g.push(h.value)}e=false;return g});if(a){return c}else{c.unshift(b.map(function(f){return f.FieldName}));return c}}function convertToChartColumn(f,e){var d=f.toLowerCase();var b=e;if(d==="date"){b=new Date(b)}else{if(d==="time"){var c=new Date("1970-01-01T"+b+"Z");b=[c.getHours(),c.dateObj.getMinutes(),c.getSeconds(),c.getMilliseconds()];d="timeofday"}else{if(d==="timestamp"){b=new Date(parseInt(b)*1000);d="datetime"}else{if(["integer","int","int64"].indexOf(d)>=0){b=parseInt(b);d="number"}else{if(["float","float64"].indexOf(d)>=0){b=parseFloat(b);d="number"}else{if(d==="boolean"){if(b==="true"){b=true}else{b=false}}}}}}}var a={value:b,dataType:d};return a}function getDataTableFields(b){var a=b.map(function(d){var c={type:d.DataType.toLowerCase(),name:d.FieldName};if(["time","timestamp"].indexOf(c.type)>=0){c.type="datetime"}else{if(["int","int64","float","float64"].indexOf(c.type)>=0){c.type="number"}}return c});return a};